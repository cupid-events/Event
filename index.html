<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>טופס אישור הגעה</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap');

    body {
      font-family: 'Heebo', Arial, sans-serif;
      text-align: center;
      background-color: #eef2f7;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 0;
    }

    /* 1. קונטיינר הטופס הלבן - מסגרת לבנה מעוגלת (ברירת מחדל / דסקטופ) */
    .form-container {
      background: #ffffff;
      
      /* מסגרת לבנה עבה ועיגול פינות */
      border: 8px solid #ffffff; 
      border-radius: 25px; 
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); 
      
      width: 100%;
      max-width: 550px;
      box-sizing: border-box;
      position: relative;
      z-index: 10;
      padding: 0;
      overflow: hidden;
    }

    /* 2. קונטיינר התמונה - גובה מוגדל (דסקטופ) */
    .form-image-header {
      width: 100%;
      height: 650px; /* **הגובה הוגדל** */
      background-image: url('mm.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      
      /* מעגל את הפינות הפנימיות העליונות בהתאם למסגרת הלבנה */
      border-top-left-radius: 17px; 
      border-top-right-radius: 17px;
    }

    /* 3. קונטיינר התוכן (טופס) */
    .form-content-wrapper {
        padding: 40px;
    }

    /* שאר ה-CSS לטופס נשאר זהה */
    input[type="text"],
    input[type="tel"],
    input[type="number"] {
      width: 100%;
      padding: 14px;
      margin: 12px 0;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
      box-sizing: border-box;
      background-color: #fcfcfc;
      text-align: center;
    }

    input[type="text"]:focus,
    input[type="tel"]:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 8px rgba(0, 123, 255, 0.2);
    }

    .radio-group {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 20px 0;
      padding: 10px 0;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    .radio-item {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .radio-group > label {
        font-weight: 700;
        color: #333;
    }

    .radio-item input[type="radio"] {
      display: none;
    }

    .radio-item label {
      position: relative;
      padding-right: 30px;
      font-size: 1rem;
      color: #555;
      cursor: pointer;
      display: flex;
      align-items: center;
      margin: 0;
    }

    .radio-item label::before {
      content: '';
      position: absolute;
      right: 0;
      width: 20px;
      height: 20px;
      border: 2px solid #ccc;
      border-radius: 50%;
      background-color: #fff;
      transition: border-color 0.3s, background-color 0.3s;
    }

    .radio-item input[type="radio"]:checked+label::before {
      border-color: #007bff;
      background-color: #007bff;
    }

    .radio-item input[type="radio"]:checked+label::after {
      content: '';
      position: absolute;
      right: 5px;
      top: 5px;
      width: 10px;
      height: 10px;
      background-color: #fff;
      border-radius: 50%;
    }

    button {
      width: 100%;
      background-color: #007bff;
      color: white;
      padding: 15px;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
      margin-top: 20px;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
    }

    button:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
    }

    #quantity-container {
      display: none;
    }

    #success-message {
      display: none;
      color: #28a745;
      font-size: 2rem;
      font-weight: 700;
      line-height: 1.4;
      padding: 50px 0;
    }

    #loading-spinner {
      display: none;
      border: 8px solid #f3f3f3;
      border-top: 8px solid #007bff;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
      margin-top: 50px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ---------------------------------- */
    /* **התאמות למובייל** */
    @media (max-width: 600px) {
      body {
        padding: 20px 0; /* נותן מרווח קטן מהקצוות במובייל */
        align-items: center;
      }
      .form-container {
        width: 90%; /* מקטין את הרוחב כדי להשאיר שוליים בצדדים */
        max-width: none;
        border-radius: 15px; /* עיגול קודקודים קטן יותר במובייל */
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
        border: 4px solid #ffffff; /* מסגרת לבנה דקה יותר במובייל */
      }
      .form-image-header {
        height: 400px; /* **הגובה הוגדל במובייל** */
        /* מעגל את הפינות הפנימיות העליונות בהתאם למסגרת */
        border-top-left-radius: 11px;
        border-top-right-radius: 11px;
      }
      .form-content-wrapper {
        padding: 20px;
      }

      input[type="text"],
      input[type="tel"],
      input[type="number"],
      button {
        padding: 12px;
        font-size: 1rem;
      }
      
      .radio-group > label {
          display: none;
      }
    }
    /* ---------------------------------- */
  </style>
</head>
<body>
  
  <div class="form-container">
    <div class="form-image-header"></div>

    <div class="form-content-wrapper">

        <div id="success-message">
          תשובתך נשמרה בהצלחה, תודה!
        </div>

        <div id="loading-spinner"></div>

        <form id="rsvp-form">
          <input type="text" name="fullName" placeholder="שם מלא" autocomplete="off" required>
          <input type="tel" name="phoneNumber" pattern="[0-9]{3}-?[0-9]{7}" placeholder="מספר טלפון (10 ספרות)" required maxlength="11" id="phoneNumberInput" autocomplete="off">
          <input type="hidden" name="rsvpId" id="rsvpId">

          <div class="radio-group">
            <label>מגיע/ה:</label>
            <div class="radio-item">
              <input type="radio" id="rsvp-yes" name="rsvpStatus" value="כן" required>
              <label for="rsvp-yes">כן</label>
            </div>
            <div class="radio-item">
              <input type="radio" id="rsvp-no" name="rsvpStatus" value="לא" required>
              <label for="rsvp-no">לא</label>
            </div>
            <div class="radio-item">
              <input type="radio" id="rsvp-maybe" name="rsvpStatus" value="אולי" required>
              <label for="rsvp-maybe">אולי</label>
            </div>
          </div>

          <div id="quantity-container">
            <input type="number" name="quantity" placeholder="כמה אנשים? (כולל אותך)" min="1">
          </div>

          <button type="submit">אישור הגעה</button>
        </form>
    </div>
  </div>

  <script>
    const form = document.getElementById("rsvp-form");
    const phoneNumberInput = document.getElementById('phoneNumberInput');
    const quantityContainer = document.getElementById('quantity-container');
    const quantityInput = quantityContainer.querySelector('input');
    const rsvpRadios = document.querySelectorAll('input[name="rsvpStatus"]');
    const successMessage = document.getElementById('success-message');
    const loadingSpinner = document.getElementById('loading-spinner');

    // זיהוי מזהה מה-URL
    const urlParams = new URLSearchParams(window.location.search);
    const rsvpId = urlParams.get('rsvpId');
    if (rsvpId) {
      document.getElementById('rsvpId').value = rsvpId;
    }

    phoneNumberInput.addEventListener('input', (event) => {
      const input = event.target;
      let value = input.value.replace(/[^0-9]/g, '');
      if (value.length > 3) {
        value = value.substring(0, 3) + '-' + value.substring(3, 10);
      }
      input.value = value;
    });

    rsvpRadios.forEach(radio => {
      radio.addEventListener('change', (event) => {
        const selectedValue = event.target.value;
        if (selectedValue === 'כן' || selectedValue === 'אולי') {
          quantityContainer.style.display = 'block';
          quantityInput.required = true;
          // אם אין ערך, שים 1 כברירת מחדל לאישור הגעה
          if (!quantityInput.value) {
            quantityInput.value = '1';
          }
        } else if (selectedValue === 'לא') {
          quantityContainer.style.display = 'none';
          quantityInput.required = false;
          quantityInput.value = '1'; // מאפס את הערך שיישמר כ-1 עבור 'לא מגיע'
        }
      });
    });

    form.addEventListener("submit", function(e) {
      e.preventDefault();
      let missingFields = [];

      if (!form.fullName.value.trim()) missingFields.push('שם מלא');
      const cleanedPhone = form.phoneNumber.value.replace(/[^0-9]/g, '');
      if (cleanedPhone.length !== 10) missingFields.push('מספר טלפון (10 ספרות)');
      const rsvpSelected = form.querySelector('input[name="rsvpStatus"]:checked');
      if (!rsvpSelected) missingFields.push('האם תגיע/י?');
      if (rsvpSelected && (rsvpSelected.value === 'כן' || rsvpSelected.value === 'אולי')) {
        if (!form.quantity.value || form.quantity.value < 1) {
          missingFields.push('כמה אנשים? (לפחות 1)');
        }
      }

      if (missingFields.length > 0) {
        alert("יש למלא את השדות הבאים:\n" + missingFields.join('\n'));
        return;
      }

      form.style.display = 'none';
      loadingSpinner.style.display = 'block';
      const data = new FormData(form);
      const params = new URLSearchParams(data);

      fetch("https://script.google.com/macros/s/AKfycbzWpgBo8WjXfAEajyjw-4RKMM5YJM6-ZKBCqYLf_7O9s9yDc_pUjerLs-OX6Iptbawg/exec", {
        method: "POST",
        body: params
      })
      .then(response => {
        loadingSpinner.style.display = 'none';
        if (response.ok) {
          successMessage.style.display = 'block';
        } else {
          alert("אירעה שגיאה בשליחה. נסה שוב.");
          form.style.display = 'block';
        }
      })
      .catch(err => {
        loadingSpinner.style.display = 'none';
        alert("שגיאה: " + err.message);
        form.style.display = 'block';
      });
    });
  </script>
</body>
</html>